<AnalysisScreen>:
    chat_input: chat_input
    chat_output: chat_output
    expense_table: expense_table
    filtro_data_inicio: filtro_data_inicio
    filtro_data_fim: filtro_data_fim
    filtro_categoria: filtro_categoria
    filtro_tipo: filtro_tipo

    BoxLayout:
        orientation: "vertical"
        padding: dp(10)
        spacing: dp(10)

        BoxLayout:
            size_hint_y: None
            height: dp(40)
            spacing: dp(5)
            Button:
                text: "Voltar ao Menu"
                on_release: root.manager.current = "menu"
            TextInput:
                id: filtro_data_inicio
                readonly: True
                on_focus: if self.focus: root.show_datepicker_inicio()

            TextInput:
                id: filtro_data_fim
                readonly: True
                on_focus: if self.focus: root.show_datepicker_fim()

            Spinner:
                id: filtro_categoria
                text: "All"
                values: root.categorias
                size_hint_x: 0.3
                on_text: root.apply_filters()

            Spinner:
                id: filtro_tipo
                text: "All"
                values: root.tipos
                size_hint_x: 0.3
                on_text: root.apply_filters()

        # Tabela com layout_manager
        ExpenseTable:
            id: expense_table
            viewclass: "ExpenseRow"
            size_hint_y: 1
            RecycleBoxLayout:
                default_size: None, dp(40)
                default_size_hint: 1, None
                size_hint_y: None
                height: self.minimum_height
                orientation: "vertical"

        BoxLayout:
            size_hint_y: None
            height: dp(40)
            spacing: dp(5)

            TextInput:
                id: chat_input
                hint_text: "Ask Gemini..."
                multiline: False

            Button:
                text: "Send"
                on_release: root.conversar()

        TextInput:
            id: chat_output
            readonly: True
            size_hint_y: None
            height: dp(80)
